<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deadboard</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
    <script defer data-domain="juanpabloruiz.github.io/deadboard" src="https://plausible.io/js/script.js"></script>

</head>

<body data-bs-theme="dark">

    <header class="p-3 bg-success text-white text-center">
        <div class="profile-picture">
            <img src="https://www.gravatar.com/avatar/9356459e6204f54bea0afb1292a0651b?s=150" alt="User" class="rounded-circle my-3">
        </div>
        <h1>Juan Pablo Ruiz</h1>
        <h2>Mi mierda personal</h2>
    </header>

    <main class="container my-3">

        


        <h3>Mi vida se está terminando...</h3>

        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <hr>

        <div id="countdown"></div>

    </main>

    <footer>
        <p id="visit-count">Cargando contador...</p>
      </footer>

      <script>
        async function updateVisitCount() {
          const user = 'juanpabloruiz'; // Tu nombre de usuario de GitHub
          const repo = 'Deadboard'; // El nombre de tu repositorio
          const path = 'counter.txt'; // La ruta al archivo dentro del repositorio
          const token = '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'; // Tu token de acceso personal de GitHub
    
          try {
            // Obtener el contenido del archivo counter.txt en el repositorio
            const response = await fetch(`https://api.github.com/repos/${user}/${repo}/contents/${path}`, {
              headers: {
                Authorization: `token ${token}`,
              },
            });
    
            if (!response.ok) {
              throw new Error(`Error al obtener el archivo: ${response.statusText}`);
            }
    
            const data = await response.json();
            console.log('Datos del archivo:', data);
            
            const content = atob(data.content);
            console.log('Contenido actual:', content);
            
            let count = parseInt(content);
    
            // Incrementar el contador
            count++;
            console.log('Nuevo contador:', count);
    
            // Mostrar el contador en la página
            document.getElementById('visit-count').innerText = `Visitas: ${count}`;
    
            // Codificar el nuevo contador en base64
            const encodedContent = btoa(count.toString());
            console.log('Contenido codificado:', encodedContent);
    
            // Escribir el nuevo contador en el archivo counter.txt en el repositorio
            const updateResponse = await fetch(`https://api.github.com/repos/${user}/${repo}/contents/${path}`, {
              method: 'PUT',
              headers: {
                Authorization: `token ${token}`,
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                message: 'Actualizar contador de visitas',
                content: encodedContent,
                sha: data.sha,
              }),
            });
    
            if (!updateResponse.ok) {
              throw new Error(`Error al actualizar el archivo: ${updateResponse.statusText}`);
            }
    
            console.log('Archivo actualizado exitosamente');
          } catch (error) {
            console.error('Ocurrió un error:', error);
          }
        }
    
        // Llamar a la función updateVisitCount() al cargar la página
        window.onload = function() {
          updateVisitCount();
        };
      </script>

    <script src="js/bootstrap.min.js"></script>
    <script src="script.js"></script>

</body>

</html>
